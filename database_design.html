<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Database Design &mdash; QCFractal 0+untagged.1.ge9cee03 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Glossary" href="glossary.html" />
    <link rel="prev" title="initialize_service" href="api/qcfractal.services.initialize_service.html" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> QCFractal
          </a>
              <div class="version">
                0+untagged.1.ge9cee03
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Install QCFractal</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup_quickstart.html">Setup Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup_server.html">Server Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup_compute.html">Manager Setup</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Records Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="results.html">Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="procedures.html">Procedures</a></li>
<li class="toctree-l1"><a class="reference internal" href="services.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="flow.html">Fractal Call Flowcharts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Manager Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="managers.html">Fractal Queue Managers</a></li>
<li class="toctree-l1"><a class="reference internal" href="managers_config_api.html">Queue Manager API</a></li>
<li class="toctree-l1"><a class="reference internal" href="managers_hpc.html">Configuration for High-Performance Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="managers_samples.html">Queue Manager Example YAML Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="managers_faq.html">Queue Manager Frequent Questions and Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="managers_detailed.html">Detailed Manager Information</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Server CLI and Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="server_init.html">Fractal Server Init</a></li>
<li class="toctree-l1"><a class="reference internal" href="server_config.html">Fractal Server Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="server_start.html">Fractal Server Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="server_user.html">Fractal Server User</a></li>
<li class="toctree-l1"><a class="reference internal" href="server_upgrade.html">Fractal Server Upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="server_view.html">Server-side Dataset Views</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="qcarchive_overview.html">QCArchive Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">QCFractal API</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Database Design</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#molecule">1) Molecule</a></li>
<li class="toctree-l2"><a class="reference internal" href="#keyword">2) Keyword</a></li>
<li class="toctree-l2"><a class="reference internal" href="#result">3) Result</a></li>
<li class="toctree-l2"><a class="reference internal" href="#procedure">4) Procedure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#services">5) Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="#taskqueue">6) TaskQueue</a></li>
<li class="toctree-l2"><a class="reference internal" href="#queuemanagers">7) QueueManagers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_guidelines.html">Development Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">QCFractal</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Database Design</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/database_design.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="database-design">
<h1>Database Design<a class="headerlink" href="#database-design" title="Permalink to this headline"></a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Final MongoDB Supported Version: 0.7.0</p>
<p><strong>0.7.0 is the last major release which support MongoDB.</strong> Fractal is moving towards a PostgreSQL database to
make upgrades more stable and because it is more suited to the nature of QCArchive Data. The upgrade path from
MongoDB to PostgreSQL will be provided by the Fractal developers in the next release. Due to the complex nature
of the upgrade, the PostgreSQL upgrade will through scripts which will be provided. After the PostgreSQL upgrade,
there will be built-in utilities to upgrade the Database.</p>
</div>
<p>QCArchive stores all its data and computations in a database in the backend
of <a class="reference external" href="https://github.com/MolSSI/QCFractal">QCFractal</a>. The DB is designed with extensibility in mind, allowing
flexibility and easy accommodation of future features. The current backend
of the DB storage is build on top of a non-relational DB, MongoDB, but it can
be easily implemented in a Relational DB like MySQL or Postgres. In addition,
Object Relational Mapping (ORM) is used to add some structure and ensure
validation on the MongoDB which does not have any by definition. The ORM used
is the most popular general MongoDB Python ORM, <a class="reference external" href="http://mongoengine.org">Mongoengine</a>.</p>
<p>The main idea behind QCArchive DB design is to be able to store and retrieve
wide range of Quantum Chemistry computations using different programs and
variety of configurations. The DB also stores information about jobs submitted
to request computations, and all their related data, along with registered users and
computational managers.</p>
<p>QCArchive DB is organized into a set of tables (or documents), each of which are detailed below.</p>
<section id="molecule">
<h2>1) Molecule<a class="headerlink" href="#molecule" title="Permalink to this headline"></a></h2>
<p>The molecule table stores molecules used in any computation in the system.
The molecule structure is based on the standard <a class="reference external" href="https://github.com/MolSSI/QC_JSON_Schema">QCSchema</a>. It stores entries like
geometry, masses, and fragment charges. Please refer to the <a class="reference external" href="https://github.com/MolSSI/QC_JSON_Schema">QCSchema</a> for a complete
description of all the possible fields.</p>
</section>
<section id="keyword">
<h2>2) Keyword<a class="headerlink" href="#keyword" title="Permalink to this headline"></a></h2>
<p>Keywords are a store of key-value pairs that are configuration for some
QC program. It is flexible and there is no restriction on what configuration
can be stored here. This table referenced by the <code class="docutils literal notranslate"><span class="pre">Result</span></code> table.</p>
</section>
<section id="result">
<h2>3) Result<a class="headerlink" href="#result" title="Permalink to this headline"></a></h2>
<p>This table stores the actual computation results along with the attributes
used to calculate it. Each entry is a single unit of computation.
The following are the unique set of keys (or indices) that define a result:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">driver</span></code> - The type of calculation being evaluated (i.e. <code class="docutils literal notranslate"><span class="pre">energy</span></code>, <code class="docutils literal notranslate"><span class="pre">gradient</span></code>, <code class="docutils literal notranslate"><span class="pre">hessian</span></code>, <code class="docutils literal notranslate"><span class="pre">properties</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">program</span></code>: such as <code class="docutils literal notranslate"><span class="pre">gamess</span></code> or <code class="docutils literal notranslate"><span class="pre">psi4</span></code> (lower case)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">molecule</span></code>: the ID of the molecule in the <code class="docutils literal notranslate"><span class="pre">Molecule</span></code> table</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">method</span></code>: the method used in the computation (b3lyp, mp2, ccsd(t))</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keywords</span></code>: the ID of the keywords in the <code class="docutils literal notranslate"><span class="pre">Keywords</span></code> table</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">basis</span></code>: the name of the basis used in the computation (6-31g, cc-pvdz, def2-svp)</p></li>
</ul>
<p>For more information see: <a class="reference internal" href="results.html"><span class="doc">Results</span></a>.</p>
</section>
<section id="procedure">
<h2>4) Procedure<a class="headerlink" href="#procedure" title="Permalink to this headline"></a></h2>
<p>Procedures are also computational results but in a more complex fashion.
They perform more aggregate computations like optimizations, torsion drive, and
grid optimization. The DB can support new types of optimizations by
inheriting from the the base procedure table. Each procedure usually reference
several other results from the <code class="docutils literal notranslate"><span class="pre">Results</span></code> table, and possibly other procedures
(self-reference).</p>
</section>
<section id="services">
<h2>5) Services<a class="headerlink" href="#services" title="Permalink to this headline"></a></h2>
<p>Services are more flexible workflows that eventually produce results to be
stored in the <code class="docutils literal notranslate"><span class="pre">Result</span></code> and/or the <code class="docutils literal notranslate"><span class="pre">Procedure</span></code> tables when they are done.
So, from the DB point of view, this is an intermediate table for on going
iterative computations.</p>
<p>More about services in QCArchive can be found here: <a class="reference internal" href="services.html"><span class="doc">Services</span></a>.</p>
</section>
<section id="taskqueue">
<h2>6) TaskQueue<a class="headerlink" href="#taskqueue" title="Permalink to this headline"></a></h2>
<p>This table is the main task queue of the system. Tasks are submitted to this
table by <a class="reference external" href="https://github.com/MolSSI/QCFractal">QCFractal</a> and wait for a manager to pull it for computation. Each
task in the queue references a <code class="docutils literal notranslate"><span class="pre">Result</span></code> or a <code class="docutils literal notranslate"><span class="pre">Procedure</span></code>, meaning that it is
corresponding to a specific Quantum computation. The table stores the status
of the task (<code class="docutils literal notranslate"><span class="pre">WAITING</span></code>, <code class="docutils literal notranslate"><span class="pre">RUNNING</span></code>, <code class="docutils literal notranslate"><span class="pre">COMPLETE</span></code>, and <code class="docutils literal notranslate"><span class="pre">ERROR</span></code>) and also
keeps track of the execution manager and the modification dates.</p>
</section>
<section id="queuemanagers">
<h2>7) QueueManagers<a class="headerlink" href="#queuemanagers" title="Permalink to this headline"></a></h2>
<p><a class="reference internal" href="managers.html#term-Manager"><span class="xref std std-term">Managers</span></a> are the registered servers for computing tasks from the <code class="docutils literal notranslate"><span class="pre">TaskQueue</span></code>.
This table keep information about the server such as the host, cluster,
number of completed tasks, submissions, and failures.</p>
<p>The database only keeps track of what <a class="reference internal" href="managers.html#term-Task"><span class="xref std std-term">Tasks</span></a> have been handed out to
each <a class="reference internal" href="managers.html#term-Manager"><span class="xref std std-term">Manager</span></a> and maintains a heartbeat to ensure the <a class="reference internal" href="managers.html#term-Manager"><span class="xref std std-term">Manager</span></a> is still connected. More information about
the configuration and execution of managers can be found here: <a class="reference internal" href="managers.html"><span class="doc">Fractal Queue Managers</span></a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="api/qcfractal.services.initialize_service.html" class="btn btn-neutral float-left" title="initialize_service" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="glossary.html" class="btn btn-neutral float-right" title="Glossary" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2021, The Molecular Sciences Software Institute.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>